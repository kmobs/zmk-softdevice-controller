rsource "src/sdc/Kconfig"

# Three-tier subrating: ACTIVE (typing) -> IDLE (~30s) -> DORMANT (+5min)
# Central controls tier transitions; peripheral requests ACTIVE on local activity

if BT_SUBRATING && ZMK_SPLIT_ROLE_CENTRAL

config ZMK_BLE_SUBRATE_TIMEOUT
	int "Supervision timeout (10ms units)"
	default 800
	range 10 3200

# ACTIVE tier
config ZMK_BLE_SUBRATE_ACTIVE_MIN
	int "Active subrate factor minimum"
	default 1
	range 1 500

config ZMK_BLE_SUBRATE_ACTIVE_MAX
	int "Active subrate factor maximum"
	default 2
	range 1 500

config ZMK_BLE_SUBRATE_ACTIVE_CN
	int "Active continuation number"
	default 1
	range 0 499

config ZMK_BLE_SUBRATE_ACTIVE_MAX_LATENCY
	int "Active maximum peripheral latency"
	default 15
	range 0 499

# IDLE tier
config ZMK_BLE_SUBRATE_IDLE_MIN
	int "Idle subrate factor minimum"
	default 1
	range 1 500

config ZMK_BLE_SUBRATE_IDLE_MAX
	int "Idle subrate factor maximum"
	default 15
	range 1 500

config ZMK_BLE_SUBRATE_IDLE_CN
	int "Idle continuation number"
	default 14
	range 0 499

config ZMK_BLE_SUBRATE_IDLE_MAX_LATENCY
	int "Idle maximum peripheral latency"
	default 2
	range 0 499

# DORMANT tier
config ZMK_BLE_SUBRATE_DORMANT_DELAY
	int "Milliseconds before dormant tier"
	default 900000
	range 10000 3600000

config ZMK_BLE_SUBRATE_DORMANT_MIN
	int "Dormant subrate factor minimum"
	default 1
	range 1 500

config ZMK_BLE_SUBRATE_DORMANT_MAX
	int "Dormant subrate factor maximum"
	default 80
	range 1 500

config ZMK_BLE_SUBRATE_DORMANT_CN
	int "Dormant continuation number"
	default 20
	range 0 499

config ZMK_BLE_SUBRATE_DORMANT_MAX_LATENCY
	int "Dormant maximum peripheral latency"
	default 0
	range 0 499

# Host connection parameters for dormant tier
# When entering dormant, request slower connection interval from hosts to save power

config ZMK_BLE_HOST_CONN_PARAM_DORMANT
	bool "Update host connection parameters when dormant"
	default y
	help
	  When entering dormant tier, request slower connection parameters from
	  host devices to reduce power consumption. Parameters are restored when
	  returning to active state.

if ZMK_BLE_HOST_CONN_PARAM_DORMANT

config ZMK_BLE_HOST_CONN_DORMANT_INT_MIN
	int "Host dormant connection interval minimum (1.25ms units)"
	default 36
	range 6 3200
	help
	  Minimum connection interval when dormant. 36 = 45ms.
	  Must be a multiple of 12 (15ms) per Apple guidelines.

config ZMK_BLE_HOST_CONN_DORMANT_INT_MAX
	int "Host dormant connection interval maximum (1.25ms units)"
	default 36
	range 6 3200
	help
	  Maximum connection interval when dormant. 36 = 45ms.
	  Must be at least 12 (15ms) greater than min, or equal to min.

config ZMK_BLE_HOST_CONN_DORMANT_LATENCY
	int "Host dormant peripheral latency"
	default 30
	range 0 30
	help
	  Number of connection events the peripheral can skip when dormant.
	  Higher values save more power but increase response latency.
	  Apple guidelines: max 30, and interval_max * (latency + 1) <= 6000ms.

config ZMK_BLE_HOST_CONN_DORMANT_TIMEOUT
	int "Host dormant supervision timeout (10ms units)"
	default 600
	range 10 3200
	help
	  Supervision timeout when dormant. 600 = 6000ms.
	  Must be > interval_max * (latency + 1) * 3.

endif # ZMK_BLE_HOST_CONN_PARAM_DORMANT

endif # BT_SUBRATING && ZMK_SPLIT_ROLE_CENTRAL
